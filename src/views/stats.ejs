<%- contentFor('body') %>
<div class="container py-5 stats-container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="display-4">Site Statistics</h1>
        <div class="timeframe-links">
            <a href="/stats?timeframe=1h" class="<%= selectedTimeframe === '1h' ? 'active' : '' %>">1H</a>
            <a href="/stats?timeframe=24h" class="<%= selectedTimeframe === '24h' ? 'active' : '' %>">24H</a>
        </div>
    </div>

    <!-- Overview Stats -->
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="stats-card">
                <h3 class="stats-value"><%= analytics.totalRequests.toLocaleString() %></h3>
                <p class="stats-label">Total Requests</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card">
                <h3 class="stats-value"><%= analytics.avgResponseTime.toFixed(0) %> ms</h3>
                <p class="stats-label">Avg Response Time</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card">
                <h3 class="stats-value text-success"><%= successRate.toFixed(1) %>%</h3>
                <p class="stats-label">Success Rate</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card">
                <h3 class="stats-value text-danger"><%= errorRate.toFixed(1) %>%</h3>
                <p class="stats-label">Error Rate</p>
            </div>
        </div>
    </div>

    <!-- Detailed Stats -->
    <div class="row g-4">
        <!-- Status Codes -->
        <div class="col-md-6">
            <div class="stats-card">
                <h3 class="stats-card-title">Status Codes</h3>
                <div class="table-responsive">
                    <table class="table stats-table mb-0">
                        <thead>
                            <tr>
                                <th>CODE</th>
                                <th>COUNT</th>
                                <th>PERCENTAGE</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% Object.entries(analytics.statusCodes)
                                .sort(([, a], [, b]) => b - a)
                                .forEach(([code, count]) => { %>
                                <tr>
                                    <td>
                                        <span class="status-badge status-<%= code.charAt(0) %>xx">
                                            <%= code %>
                                        </span>
                                    </td>
                                    <td><%= count %></td>
                                    <td><%= ((count / analytics.totalRequests) * 100).toFixed(1) %>%</td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Most Requested Paths -->
        <div class="col-md-6">
            <div class="stats-card">
                <h3 class="stats-card-title">Most Requested Paths</h3>
                <div class="table-responsive">
                    <table class="table stats-table mb-0">
                        <thead>
                            <tr>
                                <th>PATH</th>
                                <th>REQUESTS</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% Object.entries(analytics.paths)
                                .sort(([, a], [, b]) => b - a)
                                .forEach(([path, count]) => { %>
                                <tr>
                                    <td><code><%= path %></code></td>
                                    <td><%= count %></td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Geographic Distribution -->
        <div class="col-md-6">
            <div class="stats-card">
                <h3 class="stats-card-title">Geographic Distribution</h3>
                <div class="table-responsive">
                    <table class="table stats-table mb-0">
                        <thead>
                            <tr>
                                <th>COUNTRY</th>
                                <th>REQUESTS</th>
                                <th>PERCENTAGE</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% Object.entries(analytics.countries)
                                .sort(([, a], [, b]) => b - a)
                                .forEach(([country, count]) => { %>
                                <tr>
                                    <td><%= country %></td>
                                    <td><%= count %></td>
                                    <td><%= ((count / analytics.totalRequests) * 100).toFixed(1) %>%</td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Slowest Requests -->
        <div class="col-md-6">
            <div class="stats-card">
                <h3 class="stats-card-title">Slowest Requests</h3>
                <div class="table-responsive">
                    <table class="table stats-table mb-0">
                        <thead>
                            <tr>
                                <th>PATH</th>
                                <th>RESPONSE TIME</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% analytics.slowestRequests.forEach(({ path, time }) => { %>
                                <tr>
                                    <td><code><%= path %></code></td>
                                    <td><%= time %> ms</td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>